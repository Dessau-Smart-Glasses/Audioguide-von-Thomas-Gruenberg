<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dessau-Roßlau-Audioguide</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      padding: 2rem;
      background-color: #fafafa;
    }
    button {
      font-size: 1.2rem;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 12px;
      background-color: #0078d4;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #005ea1;
    }
    #status {
      margin-top: 1.5rem;
      font-size: 1rem;
      color: #333;
    }
  </style>
</head>
<body style="font-family: sans-serif; text-align: center; margin: 0; padding: 1.5em;">

  <h2 style="margin-bottom: 0.5em;">Schön, dass du da bist!</h2>

  <p style="margin-top: 0;">
    Erlebe Dessau-Roßlau per Audioguide und smarter Brille – 
    ein Projekt von <strong>Thomas Grünberg</strong>.<br><br>
    Dieser Guide ist die kompakte, digitale Begleitung zum Buch 
    und führt dich auf derselben Route – mit verkürzten Texten und klaren Stationen.
  </p>

  <p style="font-style: italic; margin: 1em 0;">
    Treffpunkt für den Testlauf: die Wiese hinter den Plattenbauten<br>
    am <strong>Hein-Steyer-Ring</strong>, schräg hinter <strong>Eisen Mänicke</strong>.<br>
    (Ehemalige Hausnummer 12 – heute abgerissen)
  </p>

  <button onclick="start()" style="padding: 0.8em 1.2em; font-size: 1em; border-radius: 8px; border: none; background-color: #333; color: white; cursor: pointer; margin-top: 1em;">
    Start
  </button>

  <p id="status" style="margin-top: 1.5em; font-size: 0.9em; color: #444;">
    GPS ist noch nicht aktiv...
  </p>

  <hr style="margin: 2em 0; border: none; border-top: 1px solid #ddd;">

  <p style="font-size: 0.8em; color: #555; line-height: 1.5;">
    <strong>Impressum & Datenschutz</strong><br>
    Verantwortlich im Sinne des §5 TMG: <strong>Thomas Grünberg</strong><br>
    Dieses Online-Angebot ist Teil eines kommerziellen Buchprojekts. 
    Die Nutzung des Audioguides ist auch ohne Buchkauf möglich.<br><br>
    Es werden keine personenbezogenen Daten gespeichert oder ausgewertet. 
    Die Standortdaten dienen ausschließlich der lokalen Positionsbestimmung auf deinem Gerät 
    und werden nicht an den Betreiber übermittelt. 
    Eine anonyme Zugriffszählung über GitHub Pages kann technisch bedingt stattfinden, 
    ohne dass Rückschlüsse auf einzelne Personen möglich sind.<br><br>
    Bereitgestellt über <em>GitHub Pages</em> (Betreiber: GitHub, Inc.).
  </p>

  <script>
    // -----------------------------
    //GPS-Ziele (Beispiele)
    // -----------------------------
    const spots = [
      {
        name: "Starttext",
  message: "Willkommen zum Audioguide-Test von Thomas Grünberg. "
         + "Um den Audiguide-Test zu starten, begeben Sie sich bitte zum Carport vor Ihrem Haus, "
         + "Sobald Sie dort ankommen sind, erkennt das System Ihren Standort automatisch "
         + "und spielt die nächste Station des Guides ab. "
         + "Dieser Test dient dazu, die Standortfunktion und Sprachausgabe zu prüfen."
      },
      {
        name: "Zielbereich Carport",
        lat: 54.293188,
        lon: 9.701321,
        radius: 15, // Meter
        message: "Sie haben den Zielbereich erreicht! "
               + "Das GPS funktioniert einwandfrei. "
               + "Fahre bitte nach links"
      },
      {
        name: "Alter Bahnhof",
        lat: 54.292717,
        lon: 9.699287,
        radius: 15, // Meter
        message: "Sie haben den Zielbereich erreicht! "
               + "Bitte biegen Sie nach links in die Straße Alter Bahnhof ab. "
               + "Fahren Sie die Straße bis zur nächsten Mitteilung."
      },
      {
        name: "Mühlenweg",
        lat: 54.291804,
        lon: 9.702292,
        radius: 15, // Meter
        message: "Sie haben den Zielbereich erreicht! "
               + "Bitte biegen Sie nach links in den Mühlenweg ab. "
               + "Fahren Sie die Straße bis zur nächsten Mitteilung."
      },
      {
        name: "Kieler Straße",
        lat: 54.293539,
        lon: 9.702736,
        radius: 15, // Meter
        message: "Sie haben den Zielbereich erreicht! "
               + "Bitte biegen Sie nach links in die Kieler Straße ab. "
               + "Fahren Sie die Straße bis zu den Carports."
      },
      {
        name: "Ende",
        lat: 54.293303,
        lon: 9.701214,
        radius: 15, // Meter
        message: "Sie haben das Ende des Audioguides erreicht! "
               + "Vielen Dank für Ihre Zeit, ich hoffe Sie hatten Spaß, schöne Grüße Thomas Grünberg "
          }
    ];

    let visited = new Set();

    //Text-to-Speech Funktion
    function speak(text) {
      const msg = new SpeechSynthesisUtterance(text);
      msg.lang = 'de-DE';
      msg.rate = 1;
      window.speechSynthesis.speak(msg);
    }

    //Entfernung zwischen 2 GPS-Punkten (Haversine-Formel)
    function distance(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const φ1 = lat1 * Math.PI / 180;
      const φ2 = lat2 * Math.PI / 180;
      const Δφ = (lat2 - lat1) * Math.PI / 180;
      const Δλ = (lon2 - lon1) * Math.PI / 180;

      const a = Math.sin(Δφ / 2) ** 2 +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    //Standort prüfen
    function checkLocation(pos) {
      const { latitude, longitude } = pos.coords;
      document.getElementById("status").innerText =
        `Aktuelle Position: ${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;

      for (let spot of spots) {
        if (!visited.has(spot.name)) {
          const dist = distance(latitude, longitude, spot.lat, spot.lon);
          if (dist < spot.radius) {
            visited.add(spot.name);
            speak(spot.message);
            alert(spot.message);
          }
        }
      }
    }

    //Start-Button-Logik
    function start() {
      speak("Audioguide gestartet. Standort wird ermittelt.");
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          checkLocation,
          err => alert("GPS-Fehler: " + err.message),
          { enableHighAccuracy: true }
        );
      } else {
        alert("GPS wird nicht unterstützt.");
      }
    }
  </script>
</body>
</html>
